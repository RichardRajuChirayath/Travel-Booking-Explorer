<div class="dashboard-container">
    <div class="header">
        <h2>My Travel Dashboard</h2>
        <p>Manage your upcoming trips and travel history.</p>
    </div>

    <!-- Expansion Panel for Quick Stats -->
    <mat-expansion-panel class="stats-panel">
        <mat-expansion-panel-header>
            <mat-panel-title>
                <mat-icon>analytics</mat-icon>
                Quick Statistics
            </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="stats-grid">
            <mat-card class="stat-card">
                <mat-icon color="primary">flight_takeoff</mat-icon>
                <h3>Total Trips</h3>
                <p class="stat-number">{{ (bookings$ | async)?.length || 0 }}</p>
            </mat-card>
            <mat-card class="stat-card">
                <mat-icon color="accent">pending</mat-icon>
                <h3>Pending</h3>
                <p class="stat-number">{{ getPendingCount(bookings$ | async) }}</p>
            </mat-card>
            <mat-card class="stat-card">
                <mat-icon color="primary">check_circle</mat-icon>
                <h3>Confirmed</h3>
                <p class="stat-number">{{ getConfirmedCount(bookings$ | async) }}</p>
            </mat-card>
        </div>
    </mat-expansion-panel>

    <!-- Material Table for Bookings -->
    <div class="bookings-section" *ngIf="bookings$ | async as bookings">
        <h3>My Bookings</h3>

        <div class="empty-state" *ngIf="bookings.length === 0">
            <mat-icon>flight_takeoff</mat-icon>
            <p>You haven't booked any trips yet.</p>
            <button mat-raised-button color="primary" routerLink="/destinations">Explore Destinations</button>
        </div>

        <table mat-table [dataSource]="bookings" class="bookings-table" *ngIf="bookings.length > 0">

            <!-- Package Column -->
            <ng-container matColumnDef="package">
                <th mat-header-cell *matHeaderCellDef>Package</th>
                <td mat-cell *matCellDef="let booking">
                    <div class="package-cell">
                        <mat-icon>card_travel</mat-icon>
                        <span>{{ booking.travelPackage?.name || 'Unknown' }}</span>
                    </div>
                </td>
            </ng-container>

            <!-- Date Column -->
            <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef>Travel Date</th>
                <td mat-cell *matCellDef="let booking">{{ booking.bookingDate | date:'mediumDate' }}</td>
            </ng-container>

            <!-- Travelers Column -->
            <ng-container matColumnDef="travelers">
                <th mat-header-cell *matHeaderCellDef>Travelers</th>
                <td mat-cell *matCellDef="let booking">
                    <mat-icon inline>group</mat-icon> {{ booking.numberOfTravelers }}
                </td>
            </ng-container>

            <!-- Amount Column -->
            <ng-container matColumnDef="amount">
                <th mat-header-cell *matHeaderCellDef>Total</th>
                <td mat-cell *matCellDef="let booking">
                    <strong>{{ booking.totalAmount | currency:'INR':'symbol':'1.0-0' }}</strong>
                </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let booking">
                    <mat-chip [color]="getStatusColor(booking.status)" selected>
                        {{ booking.status }}
                    </mat-chip>
                </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let booking">
                    <button mat-icon-button color="warn" *ngIf="booking.status !== 'Cancelled'"
                        (click)="cancelBooking(booking.id)" matTooltip="Cancel Booking">
                        <mat-icon>cancel</mat-icon>
                    </button>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
    </div>

    <div class="loading" *ngIf="!(bookings$ | async)">
        <p>Loading your bookings...</p>
    </div>
</div>